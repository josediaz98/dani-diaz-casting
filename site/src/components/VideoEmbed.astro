---
interface Props {
  url: string;
  title?: string;
}

const { url, title = 'Video' } = Astro.props;

// Parse video URL to get embed URL
function getEmbedUrl(videoUrl: string): string | null {
  if (!videoUrl) return null;

  // YouTube
  const youtubeMatch = videoUrl.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
  if (youtubeMatch) {
    return `https://www.youtube.com/embed/${youtubeMatch[1]}?rel=0`;
  }

  // Vimeo
  const vimeoMatch = videoUrl.match(/(?:vimeo\.com\/)(\d+)/);
  if (vimeoMatch) {
    return `https://player.vimeo.com/video/${vimeoMatch[1]}?title=0&byline=0&portrait=0`;
  }

  return null;
}

const embedUrl = getEmbedUrl(url);
---

{embedUrl ? (
  <div class="video-container">
    <iframe
      src={embedUrl}
      title={title}
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
      loading="lazy"
    ></iframe>
  </div>
) : (
  <div class="aspect-video bg-gray-900 flex items-center justify-center">
    <p class="text-gray-500 text-sm">Video coming soon</p>
  </div>
)}
